# æƒåˆ©é‡‘é¢„è­¦åŠŸèƒ½å®ç°æ€»ç»“

**å®ç°æ—¥æœŸ**: 2025-12-22
**åŠŸèƒ½**: æ–°å¢ç¬¬ä¸‰ç±»é¢„è­¦é‚®ä»¶ - Premium USD Alertï¼ˆæƒåˆ©é‡‘é‡‘é¢é¢„è­¦ï¼‰

---

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

åœ¨ä¸ç ´åç°æœ‰é‚®ä»¶ä½“ç³»çš„å‰æä¸‹ï¼Œæ–°å¢ç¬¬ 3 ç±»é¢„è­¦é‚®ä»¶ï¼šå½“å•ç¬”è®¢å•çš„ã€ŒæœŸæƒè…¿æ€»æƒåˆ©é‡‘ï¼ˆUSDï¼‰ã€è¶…è¿‡é˜ˆå€¼æ—¶å‘é€æé†’ã€‚

### ç³»ç»Ÿé‚®ä»¶ä½“ç³»ï¼ˆ3 ç±»ï¼‰

1. **æ¯æ—¥æ—¥æŠ¥æ€»ç»“ï¼ˆDaily Trade Reportï¼‰**
   - è§¦å‘æ—¶æœºï¼šæ¯å¤©å®šæ—¶å‘é€ï¼ˆä¸œå…«åŒº 16:00ï¼‰
   - å†…å®¹ï¼šè¿‡å» 24 å°æ—¶çš„äº¤æ˜“æ±‡æ€»ã€Top 3 æŒ‰é‡‘é¢/å¼ æ•°æ’åç­‰

2. **å¤§å®—è®¢å•å¼ æ•°é¢„è­¦ï¼ˆOptions Volume Alertï¼‰**
   - è§¦å‘æ¡ä»¶ï¼šOPTIONS ONLYï¼ŒæŒ‰å¸ç§é˜ˆå€¼
     - BTC: options_sum > 200
     - ETH: options_sum > 5000
   - å‘é€æ—¶æœºï¼šå®æ—¶ï¼ˆæ”¶åˆ°æ¶ˆæ¯åç«‹å³åˆ¤æ–­å¹¶å‘é€ï¼‰

3. **æƒåˆ©é‡‘é¢„è­¦ï¼ˆPremium USD Alertï¼‰** âœ¨ æ–°å¢
   - è§¦å‘æ¡ä»¶ï¼šOPTIONS ONLY
     - æ•´ç¬”è®¢å•æœŸæƒè…¿æ€»æƒåˆ©é‡‘ï¼ˆUSDï¼‰> $1,000,000
   - å‘é€æ—¶æœºï¼šå®æ—¶ï¼ˆæ”¶åˆ°æ¶ˆæ¯åç«‹å³åˆ¤æ–­å¹¶å‘é€ï¼‰
   - **å¯ä¸å¼ æ•°é¢„è­¦åŒæ—¶è§¦å‘**

---

## äºŒã€å®ç°ç»†èŠ‚

### STEP 1ï¼šè®¡ç®—ã€Œæ•´ç¬”è®¢å•æœŸæƒè…¿æ€»æƒåˆ©é‡‘ï¼ˆUSDï¼‰ã€

**æ–‡ä»¶**: `report_generator.py`

**æ–°å¢å­—æ®µ**:
- `options_premium_usd_sum`: æœŸæƒè…¿æ€»æƒåˆ©é‡‘ï¼ˆUSDï¼‰
- `options_premium_usd_leg_list`: æ¯æ¡è…¿çš„ premium_usd æ˜ç»†

**è®¡ç®—è§„åˆ™**ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰:
1. ä¼˜å…ˆä» `leg['total_usd']` ç›´æ¥å–
2. è‹¥æœ‰ `total_btc` ä¸”æœ‰ `ref_price_usd`: `premium_usd = abs(total_btc) * ref_price_usd`
3. è‹¥åªæœ‰ `price_btc/volume` ä¸”æœ‰ `ref_price_usd`: å…ˆç®— `total_btc = abs(price_btc) * volume`ï¼Œå†ä¹˜ä»¥ `ref_price_usd`
4. è‹¥ä»¥ä¸Šéƒ½ç¼ºå¤±ï¼šè¯¥è…¿æ ‡è®°ä¸º Unknownï¼Œæ•´ç¬”è®¢å•è·³è¿‡é¢„è­¦

**å…³é”®ç‚¹**:
- ä½¿ç”¨**ç»å¯¹å€¼æ±‡æ€»**ï¼ˆabsï¼‰ï¼Œé¿å…ä¹°/å–æ–¹å‘æŠµæ¶ˆå¯¼è‡´æ¼æŠ¥
- åªæ±‡æ€» `options_legs`ï¼Œ`non_options_legs` ä¸€å¾‹å¿½ç•¥
- è¾“å‡ºç»“æ„åŒ–æ—¥å¿—ï¼š`[PREMIUM_CALC]` / `[PREMIUM_CALC_SUM]`

**æ—¥å¿—ç¤ºä¾‹**:
```
[PREMIUM_CALC] leg#=1 contract=BTC-26DEC25-160000-P volume=25.0 total_btc=19.63 total_usd=1757640.0 price_btc=0.7852 ref=89538.57 premium_usd=1757640.00 method=total_usd
[PREMIUM_CALC] leg#=2 contract=BTC-27MAR26-160000-P volume=25.0 total_btc=19.1 total_usd=1710190.0 price_btc=0.764 ref=89538.57 premium_usd=1710190.00 method=total_usd
[PREMIUM_CALC_SUM] asset=BTC options_legs=2 premium_usd_sum=3467830.00 ref=89538.57
```

---

### STEP 2ï¼šé¢„è­¦å…¥å£åˆ¤æ–­ï¼ˆä¸¤ç§é¢„è­¦å¯åŒæ—¶è§¦å‘ï¼‰

**æ–‡ä»¶**: `message_listener.py` - `send_alert_email()`

**æ–°å¢é€»è¾‘**:
1. ä»ç„¶å…ˆæ‰§è¡Œ Option Only è¿‡æ»¤ï¼ˆ`options_count > 0`ï¼‰
2. å…ˆåšã€Œå¼ æ•°é¢„è­¦ã€åˆ¤æ–­ï¼ˆç°æœ‰é€»è¾‘ï¼ŒBTC/ETH åˆ†å¸ç§é˜ˆå€¼ï¼‰
3. å†åšã€Œæƒåˆ©é‡‘é¢„è­¦ã€åˆ¤æ–­ï¼š
   - è‹¥ `options_premium_usd_sum` ç¼ºå¤± â†’ skip å¹¶æ‰“å°æ—¥å¿—
   - è‹¥ `options_premium_usd_sum > PREMIUM_USD_THRESHOLD` â†’ è§¦å‘

**å…³é”®æ—¥å¿—**:
```
[ALERT_PREP] ... volume_trigger=true premium_trigger=true
[ALERT_MULTI] asset=BTC volume_trigger=true premium_trigger=true msg_id=...
[ALERT_SEND] type=premium asset=BTC premium_usd_sum=4590450.00 threshold=1000000 ...
[ALERT_SKIP] type=premium reason=no_ref_or_missing_premium_fields ...
```

---

### STEP 3ï¼šæƒåˆ©é‡‘é¢„è­¦é‚®ä»¶å‘é€å‡½æ•°

**æ–‡ä»¶**: `email_sender.py`

**æ–°å¢å‡½æ•°**: `send_premium_alert_html()`

**é‚®ä»¶ç‰¹å¾**:
- **æ ‡é¢˜**: `ğŸš¨ æƒåˆ©é‡‘é¢„è­¦ - BTC - $4,590,450 - Deribit - 2025-12-22 09:22:43`
- **é‚®ä»¶æ ·å¼**: ç´«è‰²æ¸å˜ä¸»é¢˜ï¼ˆåŒºåˆ«äºå¼ æ•°é¢„è­¦çš„æ©™çº¢è‰²ï¼‰
- **æ ¸å¿ƒä¿¡æ¯**:
  - æœŸæƒè…¿æ€»æƒåˆ©é‡‘ï¼ˆUSDï¼‰- é«˜äº®æ˜¾ç¤º
  - æœŸæƒè…¿æ•°é‡ & æ€»å¼ æ•°
  - è§¦å‘é˜ˆå€¼ & è¶…å‡ºå¹…åº¦
  - é€è…¿å±•ç¤º Premium (USD)
  - Greeksã€åŸå§‹æ¶ˆæ¯ç­‰

**é‡è¯•æœºåˆ¶**:
- æœ€å¤š 3 æ¬¡é‡è¯•
- æŒ‡æ•°é€€é¿ï¼ˆ2s, 4s, 8sï¼‰
- å¤±è´¥åæ‰“å°ï¼š`[EMAIL] send_failed type=premium attempt=... error=...`

---

### STEP 4ï¼šéªŒæ”¶ï¼ˆçœŸå®å†å²æ•°æ®ï¼‰

**éªŒæ”¶è„šæœ¬**: `verify_premium_alert_candidate.py`

**åŠŸèƒ½**:
1. æ‰«æç»™å®šæ—¶é—´çª—å£å†…çš„å†å² block trade æ¶ˆæ¯
2. è®¡ç®—æ¯ç¬”è®¢å•çš„ `options_premium_usd_sum`
3. è¾“å‡º Top 5 premium_usd_sum æœ€å¤§çš„è®¢å•
4. å¯é€‰ï¼šå‘é€æµ‹è¯• Premium Alert é‚®ä»¶

**éªŒæ”¶ç»“æœ**ï¼ˆæœ€è¿‘ 7 å¤©ï¼‰:
```
================================================================================
Top 5 æƒåˆ©é‡‘æœ€å¤§çš„è®¢å•
================================================================================

#1. âœ… è§¦å‘
  Message ID: 343171
  æ—¶é—´: 2025-12-19 21:34:10
  èµ„äº§: BTC @ Deribit
  æœŸæƒè…¿æ•°: 4 (700.0x)
  æ€»æƒåˆ©é‡‘: $4,590,450.00
  å¸ä»· (Ref): $87,805.05
  é˜ˆå€¼: $1,000,000
  è¶…å‡ºå¹…åº¦: 359.0%

#2. âœ… è§¦å‘
  Message ID: 343742
  æ—¶é—´: 2025-12-22 09:22:43
  èµ„äº§: BTC @ Deribit
  æœŸæƒè…¿æ•°: 2 (50.0x)
  æ€»æƒåˆ©é‡‘: $3,467,830.00
  å¸ä»· (Ref): $89,538.57
  é˜ˆå€¼: $1,000,000
  è¶…å‡ºå¹…åº¦: 246.8%

#3. âœ… è§¦å‘
  Message ID: 343569
  æ—¶é—´: 2025-12-21 16:26:15
  èµ„äº§: BTC @ Deribit
  æœŸæƒè…¿æ•°: 2 (44.0x)
  æ€»æƒåˆ©é‡‘: $2,476,510.00
  å¸ä»· (Ref): $88,303.23
  é˜ˆå€¼: $1,000,000
  è¶…å‡ºå¹…åº¦: 147.7%

[æ›´å¤š...]
```

**æµ‹è¯•é‚®ä»¶å‘é€**:
```
âœ… é‚®ä»¶å‘é€æˆåŠŸ
  Message ID: 343171
  èµ„äº§: BTC
  æ€»æƒåˆ©é‡‘: $4,590,450.00
```

---

## ä¸‰ã€é…ç½®è¯´æ˜

### æ–°å¢é…ç½®é¡¹ï¼ˆ`config.py`ï¼‰

```python
# æƒåˆ©é‡‘é˜ˆå€¼ï¼šæ•´ç¬”è®¢å•æœŸæƒè…¿æ€»æƒåˆ©é‡‘ï¼ˆUSDï¼‰è¶…è¿‡æ­¤å€¼æ—¶è§¦å‘é¢„è­¦
PREMIUM_USD_THRESHOLD = int(os.getenv('PREMIUM_USD_THRESHOLD', '1000000'))  # é»˜è®¤ 1,000,000 USD
```

### ç¯å¢ƒå˜é‡è¦†ç›–

å¯é€šè¿‡ `.env` æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡è¦†ç›–é»˜è®¤å€¼ï¼š

```bash
# é™ä½æµ‹è¯•é˜ˆå€¼
export PREMIUM_USD_THRESHOLD=500000

# æˆ–åœ¨ .env æ–‡ä»¶ä¸­
PREMIUM_USD_THRESHOLD=500000
```

---

## å››ã€ä¸‰ç±»é‚®ä»¶è§¦å‘æ¡ä»¶å¯¹æ¯”

| é‚®ä»¶ç±»å‹ | è§¦å‘æ¡ä»¶ | å‘é€æ—¶æœº | æ ‡é¢˜ç¤ºä¾‹ | é¢œè‰²ä¸»é¢˜ |
|---------|---------|---------|---------|---------|
| **æ—¥æŠ¥æ€»ç»“** | å®šæ—¶è§¦å‘ | æ¯å¤© 16:00 | ğŸ“Š Deribit æœŸæƒæ—¥æŠ¥ - 2025-12-22 | è“è‰² |
| **å¼ æ•°é¢„è­¦** | OPTIONS ONLY<br>BTC: options_sum > 200<br>ETH: options_sum > 5000 | å®æ—¶ | ğŸš¨ å•ç¬”å¤§å®—æœŸæƒé¢„è­¦ - BTC - 2025-12-22 09:22:43 - Deribit | æ©™çº¢è‰² |
| **æƒåˆ©é‡‘é¢„è­¦** | OPTIONS ONLY<br>premium_usd_sum > $1,000,000 | å®æ—¶ | ğŸš¨ æƒåˆ©é‡‘é¢„è­¦ - BTC - $4,590,450 - Deribit - 2025-12-22 09:22:43 | ç´«è‰² |

**äº’ä¸å¹²æ‰°åŸå› **:
1. **ç‹¬ç«‹åˆ¤æ–­é€»è¾‘**: å¼ æ•°é¢„è­¦å’Œæƒåˆ©é‡‘é¢„è­¦åœ¨åŒä¸€å…¥å£å¹¶è¡Œåˆ¤æ–­ï¼Œäº’ä¸å½±å“
2. **ç‹¬ç«‹å‘é€å‡½æ•°**: ä½¿ç”¨ä¸åŒçš„é‚®ä»¶å‘é€å‡½æ•°ï¼ˆ`send_single_trade_alert_html` vs `send_premium_alert_html`ï¼‰
3. **æ˜ç¡®çš„é‚®ä»¶æ ‡é¢˜/æ ·å¼**: ä¸åŒçš„ä¸»é¢˜è‰²å’Œæ ‡é¢˜æ ¼å¼ï¼Œä¾¿äºç”¨æˆ·åŒºåˆ†
4. **å¯åŒæ—¶è§¦å‘**: åŒä¸€ç¬”è®¢å•è‹¥åŒæ—¶æ»¡è¶³ä¸¤ç§é˜ˆå€¼ï¼Œä¼šå‘é€ 2 å°é‚®ä»¶ï¼Œæ ‡é¢˜ä¸åŒ

---

## äº”ã€æ”¹åŠ¨æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ”¹åŠ¨
1. **config.py**
   - æ–°å¢ï¼š`PREMIUM_USD_THRESHOLD` é…ç½®é¡¹

2. **report_generator.py**
   - æ–°å¢ï¼š`parse_block_trade_message()` æœ«å°¾æ·»åŠ æƒåˆ©é‡‘è®¡ç®—é€»è¾‘
   - æ–°å¢å­—æ®µï¼š`options_premium_usd_sum`, `options_premium_usd_leg_list`

3. **message_listener.py**
   - ä¿®æ”¹ï¼š`send_alert_email()` æ·»åŠ æƒåˆ©é‡‘é¢„è­¦åˆ¤æ–­ä¸å‘é€

4. **email_sender.py**
   - æ–°å¢ï¼š`send_premium_alert_html()` å‡½æ•°ï¼ˆå®Œæ•´ HTML æ¨¡æ¿ + é‡è¯•æœºåˆ¶ï¼‰

### éªŒæ”¶è„šæœ¬ï¼ˆæ–°å¢ï¼‰
5. **verify_premium_alert_candidate.py**
   - æ‰«æå†å²æ•°æ®
   - è®¡ç®— Top N
   - å‘é€æµ‹è¯•é‚®ä»¶

---

## å…­ã€éªŒæ”¶æ—¥å¿—å…³é”®ç‰‡æ®µ

### 1. æƒåˆ©é‡‘è®¡ç®—æ—¥å¿—

```
[PREMIUM_CALC] leg#=1 contract=BTC-27FEB26-88000-C volume=100.0 total_btc=8.28 total_usd=728230.0 price_btc=0.0828 ref=87950.61 premium_usd=728230.00 method=total_usd
[PREMIUM_CALC] leg#=2 contract=BTC-27FEB26-86000-P volume=100.0 total_btc=6.37 total_usd=560250.0 price_btc=0.0637 ref=87950.61 premium_usd=560250.00 method=total_usd
[PREMIUM_CALC] leg#=3 contract=BTC-27FEB26-70000-P volume=200.0 total_btc=3.26 total_usd=286720.0 price_btc=0.0163 ref=87950.61 premium_usd=286720.00 method=total_usd
[PREMIUM_CALC] leg#=4 contract=BTC-27FEB26-110000-C volume=200.0 total_btc=2.88 total_usd=253300.0 price_btc=0.0144 ref=87950.61 premium_usd=253300.00 method=total_usd
[PREMIUM_CALC_SUM] asset=BTC options_legs=4 premium_usd_sum=1828500.00 ref=87950.61
```

### 2. é¢„è­¦è§¦å‘æ—¥å¿—

```
[ALERT_PREP] asset=BTC exchange=Deribit options_legs=2 non_options_legs=0 options_sum=50.0 volume_threshold=200 premium_usd_sum=3467830.00 premium_threshold=1000000 volume_trigger=False premium_trigger=True
[ALERT_SEND] type=premium asset=BTC premium_usd_sum=3467830.00 threshold=1000000 contracts=BTC-26DEC25-160000-P, BTC-27MAR26-160000-P msg_id=343742
```

### 3. é‚®ä»¶å‘é€æ—¥å¿—

```
[å‘é€] æƒåˆ©é‡‘é¢„è­¦é‚®ä»¶: BTC premium_usd_sum=$4,590,450.00 @ Deribit
[2025-12-22 09:39:24] [EMAIL] smtp_connected
[2025-12-22 09:39:26] [EMAIL] html_sent subject='ã€TESTã€‘ğŸš¨ æƒåˆ©é‡‘é¢„è­¦ - BTC - $4,590,450 - Deribit - 2025-'
```

---

## ä¸ƒã€è¿è¡ŒéªŒæ”¶è„šæœ¬

### åŸºæœ¬ç”¨æ³•

```bash
# æ‰«ææ˜¨å¤©çš„æ•°æ®ï¼Œæ˜¾ç¤º Top 5
python verify_premium_alert_candidate.py --days 1

# æ‰«ææœ€è¿‘ 7 å¤©çš„æ•°æ®
python verify_premium_alert_candidate.py --days 7

# æ‰«æå¹¶å‘é€æµ‹è¯•é‚®ä»¶ï¼ˆç¬¬1æ¡ï¼‰
python verify_premium_alert_candidate.py --days 1 --send-test

# è¯•è¿è¡Œï¼ˆä¸å®é™…å‘é€é‚®ä»¶ï¼‰
python verify_premium_alert_candidate.py --days 1 --send-test --dry-run

# åªæ˜¾ç¤ºè¶…è¿‡é˜ˆå€¼çš„è®¢å•
python verify_premium_alert_candidate.py --days 7 --min-premium 1000000
```

---

## å…«ã€æ³¨æ„äº‹é¡¹

### ç¡¬è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰

1. **Option Only**: åªç»Ÿè®¡ OPTIONS è…¿ï¼ŒPERPETUAL/FUTURES/SPOT ä¸€å¾‹ä¸å‚ä¸ä»»ä½•é¢„è­¦è®¡ç®—
2. **"æ•´ç¬”è®¢å•"å£å¾„**: å¿…é¡»ç”¨è¯¥è®¢å•æ‰€æœ‰æœŸæƒè…¿æ±‡æ€»ï¼ˆsumï¼‰ï¼Œä¸èƒ½åªå–æœ€å¤§è…¿æˆ–ç¬¬ä¸€è…¿
3. **å¸ä»·æŠ˜ç®—**: æŒ‰æˆäº¤æ—¶çš„ Refï¼ˆspot/ref_price_usdï¼‰æŠ˜ç®—æˆ USD
4. **ç¼ºå¤±æ•°æ®å¤„ç†**: è‹¥æ¶ˆæ¯å†… legs éƒ½æ—  Refï¼Œä¸”å½“æ—¥ä¹Ÿæ‰¾ä¸åˆ° Spot Pricesï¼Œåˆ™æ­¤é¢„è­¦å¿…é¡»è·³è¿‡å¹¶æ‰“å°åŸå› æ—¥å¿—
5. **ä¸æ”¹æ—¥æŠ¥æ¨¡æ¿**: æƒåˆ©é‡‘é¢„è­¦ä¸å½±å“ç°æœ‰æ—¥æŠ¥å’Œå¼ æ•°é¢„è­¦çš„é€»è¾‘

### å®‰å…¨æ€§

- **é‡è¯•æœºåˆ¶**: é‚®ä»¶å‘é€å¤±è´¥è‡ªåŠ¨é‡è¯• 3 æ¬¡ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- **ç»“æ„åŒ–æ—¥å¿—**: æ‰€æœ‰å…³é”®è·¯å¾„è¾“å‡ºç»“æ„åŒ–æ—¥å¿—ï¼Œä¾¿äº grep æ’æŸ¥
- **ç‹¬ç«‹å‘é€å‡½æ•°**: æ–°å¢åŠŸèƒ½ä¸å½±å“ç°æœ‰é‚®ä»¶å‘é€é€»è¾‘

---

## ä¹ã€åç»­æ”¹è¿›å»ºè®®

1. **é˜ˆå€¼åŠ¨æ€è°ƒæ•´**: å¯æ ¹æ®å¸‚åœºæ³¢åŠ¨è‡ªåŠ¨è°ƒæ•´é˜ˆå€¼
2. **å¤šçº§é¢„è­¦**: è®¾ç½®ä¸åŒçº§åˆ«çš„é˜ˆå€¼ï¼ˆè­¦å‘Š/ä¸¥é‡/ç´§æ€¥ï¼‰
3. **å†å²è¶‹åŠ¿**: åœ¨é‚®ä»¶ä¸­å±•ç¤ºè¯¥èµ„äº§çš„å†å²æƒåˆ©é‡‘è¶‹åŠ¿
4. **æ¨é€æ¸ é“æ‰©å±•**: æ”¯æŒ Telegram/Lark ç­‰å³æ—¶é€šè®¯å·¥å…·

---

**å®ç°å®Œæˆæ—¶é—´**: 2025-12-22
**éªŒæ”¶çŠ¶æ€**: âœ… é€šè¿‡
**æµ‹è¯•é‚®ä»¶**: âœ… å‘é€æˆåŠŸ
