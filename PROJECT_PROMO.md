# SignalPlus Trade Alert æ¯æ—¥æŠ¥å‘Šç³»ç»Ÿ

## é¡¹ç›®æ¦‚è§ˆ
è‡ªåŠ¨åŒ–ç›‘å¬ Telegram é¢‘é“çš„åŠ å¯†è´§å¸å¤§å®—äº¤æ˜“ä¿¡æ¯ï¼Œç”Ÿæˆæ¯æ—¥å›¾ç‰‡æŠ¥å‘Šå¹¶é€šè¿‡é‚®ä»¶æ¨é€çš„å®æ—¶ç›‘æ§ç³»ç»Ÿã€‚

## æ ¸å¿ƒåŠŸèƒ½
- **å®æ—¶ç›‘å¬**: WebSocket é•¿è¿æ¥ç›‘å¬ SignalPlus Trade Alert é¢‘é“
- **æ™ºèƒ½è§£æ**: æ­£åˆ™è¡¨è¾¾å¼è§£æäº¤æ˜“æ¶ˆæ¯ï¼ˆç­–ç•¥ã€é‡‘é¢ã€æ•°é‡ã€IVã€Greeksï¼‰
- **åˆ†ç±»ç»Ÿè®¡**: BTC/ETH åˆ†åˆ«æŒ‰é‡‘é¢å’Œæ•°é‡æ’å Top 3
- **å›¾ç‰‡æŠ¥å‘Š**: 1200px å®½ PNG å›¾ç‰‡ï¼ŒåŒ…å«å¸‚åœºæŒ‡æ ‡ã€äº¤æ˜“ç»Ÿè®¡ã€Top 3 è¯¦æƒ…
- **å®šæ—¶æ¨é€**: æ¯æ—¥ 16:00ï¼ˆAsia/Shanghaiï¼‰è‡ªåŠ¨ç”Ÿæˆå¹¶å‘é€é‚®ä»¶

## æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶
```
TelegramClient (Telethon)
  â†“ WebSocket Push (å®æ—¶)
MessageListener (@client.on äº‹ä»¶é©±åŠ¨)
  â†“ æ¶ˆæ¯è§£æä¸å­˜å‚¨
SQLite Database (data/reports.db)
  â†“ æ•°æ®æŸ¥è¯¢
ReportGenerator (æ•°æ®å¤„ç†)
  â†“ ç”Ÿæˆç»“æ„åŒ–æ•°æ®
ImageReportGenerator (Pillow)
  â†“ æ¸²æŸ“å›¾ç‰‡
EmailSender (SMTP)
  â†“ æ¨é€æŠ¥å‘Š
```

### æŠ€æœ¯æ ˆ
- **Telegram API**: Telethon (å¼‚æ­¥äº‹ä»¶é©±åŠ¨)
- **æ•°æ®åº“**: SQLAlchemy + SQLite
- **è°ƒåº¦å™¨**: APScheduler
- **å›¾ç‰‡ç”Ÿæˆ**: Pillow (PIL)
- **é‚®ä»¶å‘é€**: smtplib
- **Python**: 3.8+

## é¡¹ç›®ç»“æ„
```
dailyreport/
â”œâ”€â”€ config.py                      # é…ç½®æ–‡ä»¶ï¼ˆAPIå¯†é’¥ã€é¢‘é“IDã€é‚®ç®±ï¼‰
â”œâ”€â”€ models.py                      # SQLAlchemy æ•°æ®æ¨¡å‹
â”œâ”€â”€ telegram_client.py             # Telegram å®¢æˆ·ç«¯å°è£…
â”œâ”€â”€ message_listener.py            # æ¶ˆæ¯ç›‘å¬å™¨ï¼ˆäº‹ä»¶å¤„ç†ï¼‰
â”œâ”€â”€ report_generator.py            # æŠ¥å‘Šæ•°æ®ç”Ÿæˆå™¨
â”œâ”€â”€ image_report_generator.py      # PNG å›¾ç‰‡ç”Ÿæˆå™¨
â”œâ”€â”€ email_sender.py                # é‚®ä»¶å‘é€å™¨
â”œâ”€â”€ task_scheduler.py              # å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
â”œâ”€â”€ main.py                        # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ data/
â”‚   â””â”€â”€ reports.db                 # SQLite æ•°æ®åº“ï¼ˆç”Ÿäº§æ•°æ®ï¼‰
â””â”€â”€ tests/
    â”œâ”€â”€ raw_messages/
    â”‚   â””â”€â”€ messages_last_30_days.json  # æµ‹è¯•æ•°æ®ï¼ˆ13,474 æ¡ï¼‰
    â””â”€â”€ reports_preview/
        â””â”€â”€ daily_report_*.png     # é¢„è§ˆå›¾ç‰‡
```

## æ•°æ®æµ

### 1. å®æ—¶ç›‘å¬ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```
Telegram é¢‘é“æ–°æ¶ˆæ¯
  â†’ WebSocket æ¨é€ï¼ˆ<1ç§’å»¶è¿Ÿï¼‰
  â†’ @client.on(events.NewMessage) è§¦å‘
  â†’ MessageListener.handle_new_message()
  â†’ è§£ææ¶ˆæ¯ç±»å‹ï¼ˆ#block / Spot Priceï¼‰
  â†’ å­˜å…¥ SQLite (Message è¡¨)
```

### 2. å®šæ—¶æŠ¥å‘Šç”Ÿæˆ
```
APScheduler è§¦å‘ï¼ˆæ¯æ—¥ 16:00ï¼‰
  â†’ æŸ¥è¯¢æœ€è¿‘24å°æ—¶æ¶ˆæ¯
  â†’ extract_spot_prices() - æå–ç°è´§ä»·æ ¼
  â†’ calculate_trade_statistics() - ç»Ÿè®¡äº¤æ˜“æ•°æ®
  â†’ extract_top_trades() - æå– Top 3ï¼ˆ4ä¸ªåˆ†ç±»ï¼‰
  â†’ generate_image_report() - ç”Ÿæˆ PNG å›¾ç‰‡
  â†’ send_email() - é‚®ä»¶æ¨é€é™„ä»¶
```

## æŠ¥å‘Šæ ¼å¼

### å›¾ç‰‡æŠ¥å‘Šå†…å®¹ï¼ˆPNG 1200x~4000pxï¼‰
1. **æ ‡é¢˜**: ğŸ“Š SignalPlus Trade Alert æ¯æ—¥æŠ¥å‘Š
2. **æ—¶é—´èŒƒå›´**: ç»Ÿè®¡æ—¶é—´æ®µï¼ˆ24å°æ—¶ï¼‰
3. **å¸‚åœºæŒ‡æ ‡**: BTC å’Œ ETH ç°è´§ä»·æ ¼
4. **äº¤æ˜“ç»Ÿè®¡**: æ€»ç¬”æ•°ã€BTC ç¬”æ•°ã€ETH ç¬”æ•°
5. **BTC Top 3**:
   - ğŸ’° æŒ‰é‡‘é¢æ’å Top 3
   - ğŸ“¦ æŒ‰æ•°é‡æ’å Top 3
6. **ETH Top 3**:
   - ğŸ’° æŒ‰é‡‘é¢æ’å Top 3
   - ğŸ“¦ æŒ‰æ•°é‡æ’å Top 3
7. **é¡µè„š**: ç”Ÿæˆæ—¶é—´

### æ¯ç¬”äº¤æ˜“æ˜¾ç¤ºä¿¡æ¯
- æ’åã€æ—¥æœŸã€ç­–ç•¥
- é‡‘é¢ï¼ˆUSDï¼‰æˆ–æ•°é‡ï¼ˆåˆçº¦xï¼‰
- åˆçº¦åç§°ã€ä»·æ ¼ã€IV
- å¸Œè…Šå­—æ¯ï¼šDelta, Gamma, Vega, Theta, Rho

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆï¼ˆPhase II + IIIï¼‰
- [x] Telegram è®¤è¯ï¼ˆStringSession æŒä¹…åŒ–ï¼‰
- [x] å®æ—¶æ¶ˆæ¯ç›‘å¬ï¼ˆäº‹ä»¶é©±åŠ¨æ¶æ„ï¼‰
- [x] SQLite æ•°æ®åº“å­˜å‚¨
- [x] æµ‹è¯•æ•°æ®å¯¼å‡ºï¼ˆ13,474 æ¡æ¶ˆæ¯ï¼Œ30å¤©ï¼‰
- [x] æ¶ˆæ¯è§£æé€»è¾‘ï¼ˆæ­£åˆ™æå–ï¼‰
- [x] Top 3 åˆ†ç±»æå–ï¼ˆ4ä¸ªç»´åº¦ï¼‰
- [x] PNG å›¾ç‰‡æŠ¥å‘Šç”Ÿæˆï¼ˆPillowï¼‰
- [x] å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆAPSchedulerï¼‰
- [x] é‚®ä»¶å‘é€åŠŸèƒ½ï¼ˆSMTPï¼‰

### âš ï¸ å¾…ä¼˜åŒ–
- [ ] extract_spot_prices() å®ç°ï¼ˆå½“å‰è¿”å› $0.0ï¼‰
- [ ] ç­–ç•¥è¯†åˆ«ä¼˜åŒ–ï¼ˆéƒ¨åˆ†æ˜¾ç¤º "Unknown"ï¼‰
- [ ] Greeks æå–å®Œå–„ï¼ˆéƒ¨åˆ†ç¼ºå¤±ï¼‰
- [ ] å›¾ç‰‡æŠ¥å‘Šé›†æˆåˆ° main.py ç”Ÿäº§æµç¨‹
- [ ] é‚®ä»¶é™„ä»¶é…ç½®ï¼ˆPNG å›¾ç‰‡ï¼‰

### ğŸ”´ æœªå¯åŠ¨
- [ ] ä¸»ç¨‹åºè¿è¡Œï¼ˆpm2 å®ˆæŠ¤è¿›ç¨‹ï¼‰
- [ ] å®æ—¶ç›‘æ§æ¿€æ´»
- [ ] ç”Ÿäº§ç¯å¢ƒæ•°æ®é‡‡é›†

## æµ‹è¯•æ•°æ®ç»Ÿè®¡
- **æ€»æ¶ˆæ¯æ•°**: 13,474 æ¡
- **æ—¶é—´èŒƒå›´**: 2025-11-11 è‡³ 2025-12-11ï¼ˆ30å¤©ï¼‰
- **å¤§å®—äº¤æ˜“**: 7,030 æ¡ï¼ˆ#block æ ‡ç­¾ï¼‰
- **ç°è´§ä»·æ ¼**: 58 æ¡
- **æœ€è¿‘24å°æ—¶**: 546 æ¡æ¶ˆæ¯ï¼ˆ292 æ¡å¤§å®—äº¤æ˜“ï¼‰
- **æµ‹è¯•å›¾ç‰‡**: 210 KB PNGï¼ˆ1200x3850pxï¼‰

## é…ç½®ä¿¡æ¯

### Telegram API
- **API ID/Hash**: config.py é…ç½®
- **Phone**: +85264915979
- **User**: @kkkkunkka (ID: 6433992017)
- **Target Chat**: SignalPlus Trade Alert

### é‚®ä»¶å‘é€
- **SMTP**: config.py é…ç½®
- **æ”¶ä»¶äºº**: EMAIL_TO åˆ—è¡¨
- **é™„ä»¶**: daily_report_YYYYMMDD_HHMMSS.png

### å®šæ—¶ä»»åŠ¡
- **æ¯æ—¥æŠ¥å‘Š**: 16:00 Asia/Shanghai
- **æ—¶åŒº**: pytz.timezone('Asia/Shanghai')

## å¿«é€Ÿå¯åŠ¨ï¼ˆå¾…æ‰§è¡Œï¼‰

### 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
```bash
cd /home/kunkka/projects/dailyreport
source .venv/bin/activate
```

### 2. å¯åŠ¨ä¸»ç¨‹åºï¼ˆpm2 å®ˆæŠ¤ï¼‰
```bash
pm2 start python --name telegram-report -- main.py
pm2 save
pm2 logs telegram-report
```

### 3. æ£€æŸ¥è¿è¡ŒçŠ¶æ€
```bash
pm2 ls                                    # æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
pm2 logs telegram-report --lines 100     # æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
sqlite3 data/reports.db "SELECT COUNT(*) FROM messages;"  # æ£€æŸ¥æ•°æ®
```

## AI å¯¹è¯å¿«é€Ÿä¸Šä¸‹æ–‡

**è¿™æ˜¯ä»€ä¹ˆé¡¹ç›®ï¼Ÿ**
ç›‘å¬ Telegram åŠ å¯†è´§å¸äº¤æ˜“é¢‘é“ï¼Œæ¯å¤©è‡ªåŠ¨ç”Ÿæˆ Top 3 äº¤æ˜“å›¾ç‰‡æŠ¥å‘Šå¹¶é‚®ä»¶æ¨é€ã€‚

**å…³é”®æŠ€æœ¯å†³ç­–**
- å®æ—¶æ¨é€ï¼ˆWebSocketï¼‰éè½®è¯¢
- StringSession é¿å… SQLite ä¼šè¯å†²çª
- å›¾ç‰‡æŠ¥å‘Šæ›¿ä»£ HTMLï¼ˆç”¨æˆ·æ˜ç¡®è¦æ±‚ï¼‰
- 4 åˆ†ç±» Top 3ï¼ˆBTC/ETH Ã— é‡‘é¢/æ•°é‡ï¼‰

**å½“å‰å¯æ‰§è¡Œæ“ä½œ**
1. `python test_report_preview.py` - ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šé¢„è§ˆ
2. `python export_test_data_v2.py` - å¯¼å‡ºæµ‹è¯•æ•°æ®
3. `pm2 start python --name telegram-report -- main.py` - å¯åŠ¨ç”Ÿäº§ç›‘æ§

**å¾…ç”¨æˆ·ç¡®è®¤**
æ˜¯å¦å¯åŠ¨ä¸»ç¨‹åºå¼€å§‹å®æ—¶ç›‘æ§ï¼Ÿ

---

**æœ€åæ›´æ–°**: 2025-12-11
**é¡¹ç›®çŠ¶æ€**: Phase III å®Œæˆï¼Œå¾…ç”Ÿäº§éƒ¨ç½²
**ç»´æŠ¤è€…**: @kkkkunkka
