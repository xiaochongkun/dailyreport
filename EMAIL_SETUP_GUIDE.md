# é‚®ä»¶ç³»ç»Ÿæµ‹è¯•æŒ‡å—

## ğŸ“‹ é…ç½®æ¸…å•

åœ¨æµ‹è¯•ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä»¥ä¸‹é…ç½®æ­£ç¡®ï¼š

### 1. å¿…é¡»é…ç½®çš„å­—æ®µ

åœ¨ `config.py` æˆ–åˆ›å»º `.env` æ–‡ä»¶ï¼Œè®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
# å¯ç”¨é‚®ä»¶åŠŸèƒ½
EMAIL_ENABLED=true

# Gmail è´¦å·é…ç½®ï¼ˆå¿…å¡«ï¼‰
EMAIL_SENDER=kunkka@signalplus.com
EMAIL_PASSWORD=ä½ çš„Gmailåº”ç”¨ä¸“ç”¨å¯†ç 

# æ”¶ä»¶äººï¼ˆå¿…å¡«ï¼Œå¯ä»¥æ˜¯å¤šä¸ªï¼Œç”¨é€—å·åˆ†éš”ï¼‰
EMAIL_RECIPIENTS=kunkka@signalplus.com
```

### 2. å¯é€‰é…ç½®ï¼ˆå·²æœ‰é»˜è®¤å€¼ï¼‰

```bash
# SMTP æœåŠ¡å™¨é…ç½®ï¼ˆé»˜è®¤ Gmailï¼‰
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USE_TLS=true

# é˜ˆå€¼é…ç½®
BTC_VOLUME_THRESHOLD=200
ETH_VOLUME_THRESHOLD=5000
```

---

## ğŸ”‘ å¦‚ä½•è·å– Gmail åº”ç”¨ä¸“ç”¨å¯†ç 

1. ç™»å½• Google è´¦å·ï¼šhttps://myaccount.google.com/
2. ç‚¹å‡»ã€Œå®‰å…¨æ€§ã€â†’ã€Œä¸¤æ­¥éªŒè¯ã€ï¼ˆå¦‚æœæœªå¼€å¯ï¼Œéœ€è¦å…ˆå¼€å¯ï¼‰
3. æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œç‚¹å‡»ã€Œåº”ç”¨ä¸“ç”¨å¯†ç ã€
4. é€‰æ‹©ã€Œé‚®ä»¶ã€å’Œã€Œå…¶ä»–ï¼ˆè‡ªå®šä¹‰åç§°ï¼‰ã€ï¼Œè¾“å…¥"Telegram Report"
5. ç‚¹å‡»ã€Œç”Ÿæˆã€ï¼Œå¤åˆ¶ 16 ä½å¯†ç ï¼ˆæ ¼å¼ï¼šxxxx xxxx xxxx xxxxï¼‰
6. å°†å¯†ç è®¾ç½®åˆ° `EMAIL_PASSWORD` é…ç½®ä¸­ï¼ˆå¯ä»¥ä¿ç•™ç©ºæ ¼æˆ–å»æ‰ï¼‰

---

## âš™ï¸ å¿«é€Ÿé…ç½®ï¼ˆæ¨èä½¿ç”¨ .env æ–‡ä»¶ï¼‰

### æ–¹å¼ 1ï¼šåˆ›å»º .env æ–‡ä»¶ï¼ˆæ¨èï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd /home/kunkka/projects/dailyreport

cat > .env << 'EOF'
# é‚®ä»¶åŠŸèƒ½å¼€å…³
EMAIL_ENABLED=true

# Gmail é…ç½®
EMAIL_SENDER=kunkka@signalplus.com
EMAIL_PASSWORD=your_app_password_here

# æ”¶ä»¶äºº
EMAIL_RECIPIENTS=kunkka@signalplus.com
EOF
```

**é‡è¦**ï¼š
- å°† `your_app_password_here` æ›¿æ¢ä¸ºä½ çš„çœŸå® Gmail åº”ç”¨ä¸“ç”¨å¯†ç 
- `.env` æ–‡ä»¶ä¸ä¼šè¢«æäº¤åˆ° gitï¼ˆå·²åœ¨ .gitignore ä¸­ï¼‰

### æ–¹å¼ 2ï¼šç›´æ¥ä¿®æ”¹ config.py

ç›´æ¥åœ¨ `config.py` ä¸­ä¿®æ”¹é»˜è®¤å€¼ï¼š

```python
EMAIL_ENABLED = True
EMAIL_SENDER = 'kunkka@signalplus.com'
EMAIL_PASSWORD = 'your_app_password_here'  # æ›¿æ¢ä¸ºçœŸå®å¯†ç 
EMAIL_RECIPIENTS = ['kunkka@signalplus.com']
```

---

## ğŸ§ª æµ‹è¯•é‚®ä»¶å‘é€

### æµ‹è¯•å‰æ£€æŸ¥

ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼š

```bash
cd /home/kunkka/projects/dailyreport
source .venv/bin/activate
```

### æµ‹è¯• 1ï¼šå‘é€æ—¥æŠ¥é‚®ä»¶

å‘é€åŸºäºå†å²æ•°æ®çš„æ—¥æŠ¥é‚®ä»¶ï¼š

```bash
python email_sender.py --test-daily --date 2025-12-11
```

**è¯´æ˜**ï¼š
- ä»æ•°æ®åº“æŸ¥è¯¢ 2025-12-11 è¿™ä¸€å¤©çš„æ‰€æœ‰æ¶ˆæ¯
- ç»Ÿè®¡ BTC/ETH çš„äº¤æ˜“ç¬”æ•°å’Œæ€»è®¢å•æ•°
- å‘é€ä¸€å°ç®€å•çš„æ—¥æŠ¥é‚®ä»¶åˆ° EMAIL_RECIPIENTS

**é¢„æœŸè¾“å‡º**ï¼š

```
============================================================
æµ‹è¯• 1: å‘é€æ—¥æŠ¥é‚®ä»¶
============================================================

æŸ¥è¯¢ 2025-12-11 çš„ç»Ÿè®¡æ•°æ®...
âœ“ ç»Ÿè®¡å®Œæˆ:
  æ€»æ¶ˆæ¯: 546
  æ€»äº¤æ˜“: 292
  BTC: 208 ç¬”, 12345.0x
  ETH: 84 ç¬”, 6789.0x

å‘é€æ—¥æŠ¥é‚®ä»¶...
æ­£åœ¨è¿æ¥ SMTP æœåŠ¡å™¨: smtp.gmail.com:587
å¯åŠ¨ TLS åŠ å¯†...
ç™»å½•è´¦å·: kunkka@signalplus.com
âœ“ SMTP è¿æ¥æˆåŠŸ
âœ“ é‚®ä»¶å‘é€æˆåŠŸ
  æ”¶ä»¶äºº: kunkka@signalplus.com
  æ ‡é¢˜: Daily Trade Report - 2025-12-11

============================================================
âœ“ æµ‹è¯•æˆåŠŸï¼è¯·æ£€æŸ¥é‚®ç®±æ”¶ä»¶
============================================================
```

**é‚®ä»¶å†…å®¹ç¤ºä¾‹**ï¼š

```
Daily Trade Report - 2025-12-11
============================================================

BTC:
  - Trades: 208
  - Block Volume: 12345.0x

ETH:
  - Trades: 84
  - Block Volume: 6789.0x

Total:
  - Messages: 546
  - Block Trades: 292

============================================================
This is a simple test version of the daily report email.
Generated at: 2025-12-11 14:30:00 CST
```

---

### æµ‹è¯• 2ï¼šå‘é€é˜ˆå€¼é¢„è­¦é‚®ä»¶

å‘é€åŸºäºé˜ˆå€¼åˆ¤æ–­çš„é¢„è­¦é‚®ä»¶ï¼š

```bash
python email_sender.py --test-alert --date 2025-12-11
```

**è¯´æ˜**ï¼š
- ä»æ•°æ®åº“æŸ¥è¯¢ 2025-12-11 è¿™ä¸€å¤©çš„ç»Ÿè®¡æ•°æ®
- åˆ¤æ–­ BTC/ETH æ€»è®¢å•æ•°æ˜¯å¦è¶…è¿‡é˜ˆå€¼
- å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œå‘é€é¢„è­¦é‚®ä»¶
- å¦‚æœæœªè¶…è¿‡ï¼Œæç¤ºæœªè§¦å‘

**å¦‚æœæœªè§¦å‘é˜ˆå€¼ï¼Œå¼ºåˆ¶å‘é€æµ‹è¯•é‚®ä»¶**ï¼š

```bash
python email_sender.py --test-alert --date 2025-12-11 --force
```

**é¢„æœŸè¾“å‡º**ï¼ˆæœªè§¦å‘é˜ˆå€¼æ—¶ï¼‰ï¼š

```
============================================================
æµ‹è¯• 2: å‘é€é˜ˆå€¼é¢„è­¦é‚®ä»¶
============================================================

æŸ¥è¯¢ 2025-12-11 çš„ç»Ÿè®¡æ•°æ®...

âœ“ ç»Ÿè®¡å®Œæˆï¼Œä½†æœªè§¦å‘é˜ˆå€¼:
  BTC: 150.0 <= 200
  ETH: 3000.0 <= 5000

æç¤º: ä½¿ç”¨ --force å‚æ•°å¯ä»¥å¼ºåˆ¶å‘é€æµ‹è¯•é‚®ä»¶
```

**é¢„æœŸè¾“å‡º**ï¼ˆä½¿ç”¨ --force æ—¶ï¼‰ï¼š

```
============================================================
æµ‹è¯• 2: å‘é€é˜ˆå€¼é¢„è­¦é‚®ä»¶
============================================================

æŸ¥è¯¢ 2025-12-11 çš„ç»Ÿè®¡æ•°æ®...

âš  æ³¨æ„: å®é™…æ•°æ®æœªè§¦å‘é˜ˆå€¼ï¼Œä½†ä½¿ç”¨ --force å¼ºåˆ¶å‘é€æµ‹è¯•é‚®ä»¶
  BTC: 150.0 <= 200
  ETH: 3000.0 <= 5000

å¼ºåˆ¶è§¦å‘ BTC é˜ˆå€¼ï¼ˆä»…ä¾›æµ‹è¯•ï¼‰...

============================================================
å‡†å¤‡å‘é€é˜ˆå€¼é¢„è­¦é‚®ä»¶: 2025-12-11
============================================================

è§¦å‘çš„èµ„äº§: BTC
ç»Ÿè®¡æ•°æ®:
  BTC: 150.0x (é˜ˆå€¼: 200)
  ETH: 3000.0x (é˜ˆå€¼: 5000)

å‘é€é˜ˆå€¼é¢„è­¦é‚®ä»¶...
æ­£åœ¨è¿æ¥ SMTP æœåŠ¡å™¨: smtp.gmail.com:587
å¯åŠ¨ TLS åŠ å¯†...
ç™»å½•è´¦å·: kunkka@signalplus.com
âœ“ SMTP è¿æ¥æˆåŠŸ
âœ“ é‚®ä»¶å‘é€æˆåŠŸ
  æ”¶ä»¶äºº: kunkka@signalplus.com
  æ ‡é¢˜: âš ï¸ Volume Alert: BTC > 200 orders on 2025-12-11

============================================================
âœ“ æµ‹è¯•æˆåŠŸï¼è¯·æ£€æŸ¥é‚®ç®±æ”¶ä»¶
============================================================
```

**é‚®ä»¶å†…å®¹ç¤ºä¾‹**ï¼š

```
Volume Threshold Alert - 2025-12-11
============================================================

THRESHOLD CONFIGURATION:
  - BTC Threshold: 200 orders
  - ETH Threshold: 5000 orders

TODAY'S STATISTICS:
  BTC:
    - Total Volume: 250.0 orders âš ï¸ EXCEEDED
    - Trade Count: 35 trades

  ETH:
    - Total Volume: 3000.0 orders âœ…
    - Trade Count: 48 trades

  Total Trades: 83

TRIGGERED ASSETS:
  BTC

RECOMMENDATION:
  Market activity is significantly elevated. Review the daily
  report for detailed breakdown.

============================================================
This is a simple test version of the volume alert email.
Generated at: 2025-12-11 14:30:00 CST
```

---

## ğŸ” æµ‹è¯•å…¶ä»–æ—¥æœŸ

æŸ¥çœ‹æ•°æ®åº“ä¸­æœ‰å“ªäº›æ—¥æœŸçš„æ•°æ®ï¼š

```bash
source .venv/bin/activate
python -c "
from database import get_session, Message
from datetime import datetime
import pytz

session = get_session()
messages = session.query(Message).order_by(Message.date).all()

if messages:
    dates = set([msg.date.date() for msg in messages])
    print('æ•°æ®åº“ä¸­æœ‰ä»¥ä¸‹æ—¥æœŸçš„æ•°æ®:')
    for date in sorted(dates):
        count = len([m for m in messages if m.date.date() == date])
        block_count = len([m for m in messages if m.date.date() == date and m.is_block_trade])
        print(f'  {date}: {count} æ¡æ¶ˆæ¯ ({block_count} æ¡å¤§å®—äº¤æ˜“)')
else:
    print('æ•°æ®åº“ä¸ºç©º')

session.close()
"
```

---

## âŒ å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æç¤º "EMAIL_PASSWORD æœªè®¾ç½®"

**åŸå› **ï¼šGmail åº”ç”¨ä¸“ç”¨å¯†ç æœªé…ç½®

**è§£å†³**ï¼š
1. æ£€æŸ¥ `.env` æ–‡ä»¶æˆ– `config.py` ä¸­æ˜¯å¦è®¾ç½®äº† `EMAIL_PASSWORD`
2. ç¡®ä¿å¯†ç æ˜¯ Gmail åº”ç”¨ä¸“ç”¨å¯†ç ï¼Œä¸æ˜¯ Google è´¦å·å¯†ç 
3. ç¡®ä¿ `.env` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•

### 2. SMTP è®¤è¯å¤±è´¥ (535 Authentication failed)

**åŸå› **ï¼šå¯†ç é”™è¯¯æˆ–æœªå¯ç”¨"åº”ç”¨ä¸“ç”¨å¯†ç "åŠŸèƒ½

**è§£å†³**ï¼š
1. ç¡®è®¤ Gmail è´¦å·å·²å¼€å¯ã€Œä¸¤æ­¥éªŒè¯ã€
2. é‡æ–°ç”Ÿæˆåº”ç”¨ä¸“ç”¨å¯†ç 
3. ç¡®ä¿å¤åˆ¶çš„å¯†ç å®Œæ•´ï¼ˆ16ä½å­—ç¬¦ï¼‰

### 3. è¿æ¥è¶…æ—¶ (timeout)

**åŸå› **ï¼šç½‘ç»œé—®é¢˜æˆ–é˜²ç«å¢™é˜»æ­¢

**è§£å†³**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å°è¯• ping smtp.gmail.com
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿å…è®¸ 587 ç«¯å£

### 4. æç¤º "No data for date XXXX"

**åŸå› **ï¼šæ•°æ®åº“ä¸­æ²¡æœ‰è¯¥æ—¥æœŸçš„æ•°æ®

**è§£å†³**ï¼š
1. ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤æŸ¥çœ‹æ•°æ®åº“ä¸­æœ‰å“ªäº›æ—¥æœŸ
2. é€‰æ‹©ä¸€ä¸ªæœ‰æ•°æ®çš„æ—¥æœŸè¿›è¡Œæµ‹è¯•
3. æˆ–è€…ç­‰å¾…ç³»ç»Ÿå®æ—¶é‡‡é›†æ•°æ®åå†æµ‹è¯•

---

## ğŸ“§ æ”¶åˆ°æµ‹è¯•é‚®ä»¶å

å¦‚æœæˆåŠŸæ”¶åˆ°ä¸¤å°æµ‹è¯•é‚®ä»¶ï¼Œè¯´æ˜é‚®ä»¶å‘é€éª¨æ¶å·²ç»è·‘é€šï¼

**ä¸‹ä¸€æ­¥**ï¼š
1. âœ… ç¡®è®¤ä¸¤å°é‚®ä»¶éƒ½èƒ½æ­£å¸¸æ¥æ”¶
2. âœ… æ£€æŸ¥é‚®ä»¶å†…å®¹æ˜¯å¦åŒ…å«æ­£ç¡®çš„ç»Ÿè®¡æ•°æ®
3. âœ… å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€é˜¶æ®µï¼šå°†é‚®ä»¶å‘é€é›†æˆåˆ° scheduler å®šæ—¶ä»»åŠ¡ä¸­

---

## ğŸ“ é…ç½®æ–‡ä»¶ç¤ºä¾‹

### å®Œæ•´çš„ .env æ–‡ä»¶ç¤ºä¾‹

```bash
# ============================================
# é‚®ä»¶é…ç½®
# ============================================
EMAIL_ENABLED=true

# Gmail SMTP é…ç½®
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USE_TLS=true

# Gmail è´¦å·
EMAIL_SENDER=kunkka@signalplus.com
EMAIL_PASSWORD=abcd efgh ijkl mnop  # 16ä½åº”ç”¨ä¸“ç”¨å¯†ç 

# æ”¶ä»¶äººï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰
EMAIL_RECIPIENTS=kunkka@signalplus.com

# ============================================
# é˜ˆå€¼é¢„è­¦é…ç½®
# ============================================
VOLUME_ALERT_ENABLED=true
BTC_VOLUME_THRESHOLD=200
ETH_VOLUME_THRESHOLD=5000
```

---

**å‡†å¤‡å¥½åï¼Œå¼€å§‹æµ‹è¯•ï¼**
